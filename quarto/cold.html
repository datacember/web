<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SQLippery when Icy!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cold_files/libs/clipboard/clipboard.min.js"></script>
<script src="cold_files/libs/quarto-html/quarto.js"></script>
<script src="cold_files/libs/quarto-html/popper.min.js"></script>
<script src="cold_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cold_files/libs/quarto-html/anchor.min.js"></script>
<link href="cold_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cold_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cold_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cold_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cold_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#antartica" id="toc-antartica" class="nav-link active" data-scroll-target="#antartica"><span class="header-section-number">1</span> Antartica!</a></li>
  <li><a href="#your-task" id="toc-your-task" class="nav-link" data-scroll-target="#your-task"><span class="header-section-number">2</span> Your Task</a>
  <ul class="collapse">
  <li><a href="#seasons" id="toc-seasons" class="nav-link" data-scroll-target="#seasons"><span class="header-section-number">2.1</span> Seasons</a></li>
  <li><a href="#broken-instruments" id="toc-broken-instruments" class="nav-link" data-scroll-target="#broken-instruments"><span class="header-section-number">2.2</span> Broken Instruments</a></li>
  <li><a href="#forecasting" id="toc-forecasting" class="nav-link" data-scroll-target="#forecasting"><span class="header-section-number">2.3</span> Forecasting</a></li>
  <li><a href="#wildcard" id="toc-wildcard" class="nav-link" data-scroll-target="#wildcard"><span class="header-section-number">2.4</span> Wildcard</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">3</span> Data</a></li>
  <li><a href="#running-sql" id="toc-running-sql" class="nav-link" data-scroll-target="#running-sql"><span class="header-section-number">4</span> Running SQL</a></li>
  <li><a href="#final-notes" id="toc-final-notes" class="nav-link" data-scroll-target="#final-notes"><span class="header-section-number">5</span> Final notes</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SQLippery when Icy!</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="antartica" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="antartica"><span class="header-section-number">1</span> Antartica!</h2>
<div class="{.columns">
<div class="column" style="width:100%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/penguin.png" title="View of Antartica" class="img-fluid figure-img"></p>
<figcaption>üêß</figcaption>
</figure>
</div>
</div>
</div>
<p>Hello, Privyet, Hola, and ‡§®‡§Æ‡§∏‡•ç‡§§‡•á are some of the languages you may hear spoken at one of the many Antarctic research stations.</p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Australia specifically operates four major Antarctic stations that collect critical meteorological data and conduct science on the world‚Äôs coolest continent. This data is essential for wildlife monitoring, glaciology, and, critically, meteorology. These four stations are Casey, Mawson, Davis, and Macquarie Island.</p>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/stations.png" class="img-fluid figure-img" style="width:75.0%"></p>
<figcaption>Stations of antartica map. We are only concerned with Mawson, Davis, Casey and Macquarie Island</figcaption>
</figure>
</div>
</div>
</div>
<p>Fun fact: Mawson Station, established in 1911, was the first Australian station in Antarctica and is located in the only part of the Antarctic continent that is not covered by ice!</p>
</section>
<section id="your-task" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="your-task"><span class="header-section-number">2</span> Your Task</h2>
<p>You are to create a report investigating the data in antartica. Below are a few ideas:</p>
<section id="seasons" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="seasons"><span class="header-section-number">2.1</span> Seasons</h3>
<p>Does Antartica have seasons, and how do these affect climate across the 4 stations.</p>
<p>Here are some motivating your data exploration: - Does Antartica have distinct seasons - Is there enough data to classify different seasons, what are their charectaristics? - Try producing a time series plot of the data. How does it look?</p>
</section>
<section id="broken-instruments" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="broken-instruments"><span class="header-section-number">2.2</span> Broken Instruments</h3>
<p>For a more intermediate report motivated by statistics, are there certain instruments that are faulty more often than others (missing values, outliers)?</p>
<p>Write your findings up into a brief report. Here are a few questions to motivate your research:</p>
<ul>
<li>What are some limitations in the data that prevent you from fully understanding</li>
<li>Are instruments consistently innacurate / broken at the <span class="math inline">\(\alpha=0.05\)</span> theshold for significance?</li>
</ul>
</section>
<section id="forecasting" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="forecasting"><span class="header-section-number">2.3</span> Forecasting</h3>
<p>For an advanced report, produce a model that will forecast the weather based on previous meterological factors.</p>
<ul>
<li>Is there any issues within the data that prevent the model from learning weather patterns?</li>
<li>How well does your model perform?</li>
<li>What kind of model selections did you make?</li>
</ul>
</section>
<section id="wildcard" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="wildcard"><span class="header-section-number">2.4</span> Wildcard</h3>
<blockquote class="blockquote">
<p><strong>Note</strong>: if you have an idea that you want to explore feel free to. Provide some context and motivation as to why.</p>
</blockquote>
</section>
</section>
<section id="data" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="data"><span class="header-section-number">3</span> Data</h2>
<p>This challenges data is acsessible through SQL. See below for a guide on how to run sql.</p>
<p>Generally, each of the stations has its own table, <code>casey</code>, <code>davis</code>, <code>mawson</code>, and <code>macquarrie_island</code> respectively. Each table in the database follows the same format:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 28%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th>Column Name</th>
<th>Full Name</th>
<th>Description</th>
<th>Database Type</th>
<th>Units</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Day</td>
<td>Day</td>
<td>The day of the month</td>
<td>INTEGER</td>
<td>Days</td>
</tr>
<tr class="even">
<td>Month</td>
<td>Month</td>
<td>The month of the year</td>
<td>INTEGER</td>
<td>Months</td>
</tr>
<tr class="odd">
<td>Year</td>
<td>Year</td>
<td>The year</td>
<td>INTEGER</td>
<td>Years</td>
</tr>
<tr class="even">
<td>MinTemp</td>
<td>Minimum Temperature</td>
<td>The minimum temperature recorded</td>
<td>REAL</td>
<td>¬∞C</td>
</tr>
<tr class="odd">
<td>MaxTemp</td>
<td>Maximum Temperature</td>
<td>The maximum temperature recorded</td>
<td>REAL</td>
<td>¬∞C</td>
</tr>
<tr class="even">
<td>Rainfall</td>
<td>Rainfall</td>
<td>The total rainfall</td>
<td>REAL</td>
<td>mm</td>
</tr>
<tr class="odd">
<td>Evap</td>
<td>Evaporation</td>
<td>The amount of evaporation</td>
<td>REAL</td>
<td>mm</td>
</tr>
<tr class="even">
<td>Sunshine</td>
<td>Sunshine</td>
<td>The total sunshine hours</td>
<td>REAL</td>
<td>Hours</td>
</tr>
<tr class="odd">
<td>GustDir</td>
<td>Gust Direction</td>
<td>The direction of the strongest gust</td>
<td>TEXT</td>
<td>Compass Direction</td>
</tr>
<tr class="even">
<td>GustSpeed</td>
<td>Gust Speed</td>
<td>The speed of the strongest gust</td>
<td>REAL</td>
<td>km/h</td>
</tr>
<tr class="odd">
<td>GustTime</td>
<td>Gust Time</td>
<td>The time of the strongest gust</td>
<td>TEXT</td>
<td>HH:MM format</td>
</tr>
<tr class="even">
<td>Temp9am</td>
<td>Temperature at 9 AM</td>
<td>The temperature recorded at 9 AM</td>
<td>REAL</td>
<td>¬∞C</td>
</tr>
<tr class="odd">
<td>Humid9am</td>
<td>Humidity at 9 AM</td>
<td>The humidity recorded at 9 AM</td>
<td>REAL</td>
<td>Percentage (%)</td>
</tr>
<tr class="even">
<td>Cloud9am</td>
<td>Cloud Cover at 9 AM</td>
<td>The cloud cover recorded at 9 AM</td>
<td>INTEGER</td>
<td>Octas</td>
</tr>
<tr class="odd">
<td>WindDir9am</td>
<td>Wind Direction at 9 AM</td>
<td>The wind direction recorded at 9 AM</td>
<td>TEXT</td>
<td>Compass Direction</td>
</tr>
<tr class="even">
<td>Windspd9am</td>
<td>Wind Speed at 9 AM</td>
<td>The wind speed recorded at 9 AM</td>
<td>REAL</td>
<td>km/h</td>
</tr>
<tr class="odd">
<td>Press9am</td>
<td>Pressure at 9 AM</td>
<td>The atmospheric pressure recorded at 9 AM</td>
<td>REAL</td>
<td>hPa</td>
</tr>
<tr class="even">
<td>Temp3pm</td>
<td>Temperature at 3 PM</td>
<td>The temperature recorded at 3 PM</td>
<td>REAL</td>
<td>¬∞C</td>
</tr>
<tr class="odd">
<td>Humid3pm</td>
<td>Humidity at 3 PM</td>
<td>The humidity recorded at 3 PM</td>
<td>REAL</td>
<td>Percentage (%)</td>
</tr>
<tr class="even">
<td>Cloud3pm</td>
<td>Cloud Cover at 3 PM</td>
<td>The cloud cover recorded at 3 PM</td>
<td>INTEGER</td>
<td>Octas</td>
</tr>
<tr class="odd">
<td>WindDir3pm</td>
<td>Wind Direction at 3 PM</td>
<td>The wind direction recorded at 3 PM</td>
<td>TEXT</td>
<td>Compass Direction</td>
</tr>
<tr class="even">
<td>Windspd3pm</td>
<td>Wind Speed at 3 PM</td>
<td>The wind speed recorded at 3 PM</td>
<td>REAL</td>
<td>km/h</td>
</tr>
<tr class="odd">
<td>Press3pm</td>
<td>Pressure at 3 PM</td>
<td>The atmospheric pressure recorded at 3 PM</td>
<td>REAL</td>
<td>hPa</td>
</tr>
</tbody>
</table>
<p>Beware: there are missing entries.</p>
</section>
<section id="running-sql" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="running-sql"><span class="header-section-number">4</span> Running SQL</h2>
<p>For this task it is highly reccomended that you use python. Use the following guide as a quickstart on how to get the data for this challenge.</p>
<blockquote class="blockquote">
<p><strong>Note</strong>: If you are unfamiliar with python, and want to just use basic sql, you can use the <a href="/workspace"> web-client for running your sql queries</a>.</p>
</blockquote>
<p>First, lets import the client connection. You will use this to interface with the server on which your sql will be run.</p>
<p><code>pip install git+https://github.com/datacember/datacember.git@main</code></p>
<p>Now lets import the dataset connection to the antartica database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datacember <span class="im">import</span> antartica</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Due to the way that the <code>datacember_connection</code> object works, its easiest to use the class in a context manager. Below we will do this with an example running a sql query to select 2 records from the Mawson station.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> antartica(username<span class="op">=</span><span class="st">"wingfooted"</span>, password<span class="op">=</span><span class="st">"password"</span>) <span class="im">as</span> db:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  content <span class="op">=</span> db(<span class="st">"SELECT * FROM mawson LIMIT 2;"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> row <span class="kw">in</span> content:</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(row)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>bc0bd78e72ae0ded1e2ef8f3bdd2959578414e08be4ee02438eb12beddae341c http://127.0.0.1:8999/sql
[1, 10, 2024, -23.7, -20.3, None, None, 4.1, 'SE', 70.0, '09:15', -21.1, 46.0, None, 'SE', 54.0, 990.4, -20.5, 40.0, None, 'ESE', 54.0, 989.5]
[2, 10, 2024, -25.5, -18.3, None, None, 12.0, 'SSE', 65.0, '03:28', -23.7, 41.0, None, 'SSE', 46.0, 988.7, -18.7, 35.0, None, 'WSW', 11.0, 992.2]</code></pre>
</div>
</div>
<p>Voila!</p>
<p>A few things to note when using the <code>datacember</code> module. I have written this on my own, so I am sure there are a few bugs present. Contact me and I will try get it sorted out.</p>
<p>However some of your errors may be explained by:</p>
<ul>
<li><p>session expiry. Your session lasts 10 minutes, meaning all code you run from within the context manager has 10 minutes to run before a hidden token expires, and your code will not run. Re-entering the context manager (with correct password and username!) mints a new token.</p></li>
<li><p>Rate limiting. You will be limited after 20 requests per minute.</p></li>
<li><p>Invalid SQL. Ideally an error should be raised when your sql is invalid. All sql on the back-end is run with sqlite3, so all the syntax must conform with the conventiosn of sqlite3.</p></li>
</ul>
<p>If you have any suggestions or want to work with me on the datacember class, or have ideas on how to improve it message me and we can implement some ideas.</p>
</section>
<section id="final-notes" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="final-notes"><span class="header-section-number">5</span> Final notes</h2>
<p>If you are new to SQL you can find a <a href="/guide/sql"> brief guide here</a></p>
<p>You can find additional examples and documentation on the <a href="/guide/datacember-module"> datacember module here </a></p>
<p>See our <a href="/guide/report"> report writing guide here </a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>